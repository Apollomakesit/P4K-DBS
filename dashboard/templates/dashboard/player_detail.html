{% extends "dashboard/base.html" %}

{% block title %}{{ player.username }} - Pro4Kings{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Breadcrumb -->
    <nav class="text-sm text-gray-400">
        <a href="/players" class="hover:text-white transition-colors">Players</a>
        <span class="mx-2">/</span>
        <span class="text-white">{{ player.username }}</span>
    </nav>
    
    <!-- Player Header -->
    <div class="bg-p4k-card border border-p4k-border rounded-xl p-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div class="flex items-center space-x-4">
                <div class="w-20 h-20 bg-gradient-to-br from-p4k-accent to-p4k-purple rounded-xl flex items-center justify-center">
                    <span class="text-3xl font-bold text-white">{{ player.username[0] | upper if player.username else '?' }}</span>
                </div>
                <div>
                    <div class="flex items-center space-x-3">
                        <h1 class="text-2xl font-bold text-white">{{ player.username }}</h1>
                        {% if player.is_currently_online %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-p4k-green/20 text-p4k-green">
                            <i class="fas fa-circle text-xs mr-2 pulse-online"></i>Online Now
                        </span>
                        {% else %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-500/20 text-gray-400">
                            <i class="far fa-circle text-xs mr-2"></i>Offline
                        </span>
                        {% endif %}
                    </div>
                    <p class="text-gray-400 mt-1">Player ID: {{ player.player_id }}</p>
                </div>
            </div>
            <div class="mt-4 md:mt-0">
                <a href="https://panel.pro4kings.ro/profile/{{ player.player_id }}" target="_blank" 
                    class="inline-flex items-center px-4 py-2 bg-p4k-border hover:bg-p4k-border/70 rounded-lg text-gray-300 transition-colors">
                    <i class="fas fa-external-link-alt mr-2"></i>View on Panel
                </a>
            </div>
        </div>
    </div>
    
    <!-- Stats Grid -->
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
        <!-- Faction -->
        <div class="bg-p4k-card border border-p4k-border rounded-xl p-4">
            <p class="text-gray-400 text-sm">Faction</p>
            {% if player.faction and player.faction not in ['Civil', 'Fără', 'None', '-'] %}
            <a href="/faction/{{ player.faction }}" class="text-p4k-purple hover:underline font-medium">{{ player.faction }}</a>
            <p class="text-gray-500 text-xs">{{ player.faction_rank or 'Member' }}</p>
            {% else %}
            <p class="text-white font-medium">No faction</p>
            {% endif %}
        </div>
        
        <!-- Job -->
        <div class="bg-p4k-card border border-p4k-border rounded-xl p-4">
            <p class="text-gray-400 text-sm">Job</p>
            <p class="text-white font-medium">{{ player.job or 'Unemployed' }}</p>
        </div>
        
        <!-- Played Hours -->
        <div class="bg-p4k-card border border-p4k-border rounded-xl p-4">
            <p class="text-gray-400 text-sm">Played Hours</p>
            <p class="text-white font-medium">{{ "%.1f" | format(player.played_hours or 0) }}h</p>
        </div>
        
        <!-- Warnings -->
        <div class="bg-p4k-card border border-p4k-border rounded-xl p-4">
            <p class="text-gray-400 text-sm">Warnings</p>
            {% set warns = player.warnings or 0 %}
            <p class="font-medium {% if warns == 0 %}text-p4k-green{% elif warns < 3 %}text-yellow-400{% else %}text-p4k-red{% endif %}">
                {{ warns }}/3
            </p>
        </div>
        
        <!-- Age IC -->
        <div class="bg-p4k-card border border-p4k-border rounded-xl p-4">
            <p class="text-gray-400 text-sm">Age (IC)</p>
            <p class="text-white font-medium">{{ player.age_ic or 'Unknown' }}</p>
        </div>
        
        <!-- Total Actions -->
        <div class="bg-p4k-card border border-p4k-border rounded-xl p-4">
            <p class="text-gray-400 text-sm">Total Actions</p>
            <p class="text-white font-medium">{{ "{:,}".format(player.total_actions or 0) }}</p>
        </div>
    </div>
    
    <!-- Tabs Content -->
    <div class="grid lg:grid-cols-2 gap-6">
        <!-- Recent Actions -->
        <div class="bg-p4k-card border border-p4k-border rounded-xl overflow-hidden">
            <div class="px-6 py-4 border-b border-p4k-border">
                <h2 class="text-lg font-semibold text-white">
                    <i class="fas fa-list mr-2 text-p4k-accent"></i>Recent Actions
                </h2>
            </div>
            <div class="divide-y divide-p4k-border max-h-96 overflow-y-auto scrollbar-thin">
                {% for action in actions[:20] %}
                <div class="px-6 py-3 hover:bg-p4k-border/30 transition-colors">
                    <div class="flex items-start justify-between">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2">
                                <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full 
                                    {% if action.action_type == 'item_given' %}bg-emerald-500/20 text-emerald-400
                                    {% elif action.action_type == 'item_received' %}bg-green-500/20 text-green-400
                                    {% elif action.action_type == 'money_transfer' %}bg-yellow-500/20 text-yellow-400
                                    {% elif action.action_type == 'money_deposit' %}bg-amber-500/20 text-amber-400
                                    {% elif action.action_type == 'money_withdraw' %}bg-orange-500/20 text-orange-400
                                    {% elif action.action_type == 'chest_deposit' %}bg-blue-500/20 text-blue-400
                                    {% elif action.action_type == 'chest_withdraw' %}bg-sky-500/20 text-sky-400
                                    {% elif action.action_type == 'warning_received' %}bg-orange-600/20 text-orange-500
                                    {% elif action.action_type == 'ban_received' %}bg-red-600/20 text-red-500
                                    {% elif action.action_type == 'admin_jail' %}bg-red-500/20 text-red-400
                                    {% elif action.action_type == 'admin_unjail' %}bg-lime-500/20 text-lime-400
                                    {% elif action.action_type == 'admin_unban' %}bg-green-600/20 text-green-500
                                    {% elif action.action_type == 'mute_received' %}bg-zinc-500/20 text-zinc-400
                                    {% elif action.action_type == 'trade' %}bg-purple-500/20 text-purple-400
                                    {% elif action.action_type == 'vehicle_contract' %}bg-cyan-500/20 text-cyan-400
                                    {% elif action.action_type == 'vehicle_bought' %}bg-teal-500/20 text-teal-400
                                    {% elif action.action_type == 'vehicle_sold' %}bg-indigo-500/20 text-indigo-400
                                    {% elif action.action_type == 'vehicle_scrapped' %}bg-rose-500/20 text-rose-400
                                    {% elif action.action_type == 'bank_heist_delivery' %}bg-fuchsia-500/20 text-fuchsia-400
                                    {% elif action.action_type == 'faction_kicked' %}bg-red-700/20 text-red-600
                                    {% elif action.action_type == 'kill_character' %}bg-red-900/20 text-red-700
                                    {% else %}bg-gray-500/20 text-gray-400{% endif %}">
                                    {% if action.action_type == 'item_given' %}<i class="fas fa-hand-holding mr-1"></i>
                                    {% elif action.action_type == 'item_received' %}<i class="fas fa-gift mr-1"></i>
                                    {% elif action.action_type == 'money_transfer' %}<i class="fas fa-money-bill-transfer mr-1"></i>
                                    {% elif action.action_type == 'money_deposit' %}<i class="fas fa-piggy-bank mr-1"></i>
                                    {% elif action.action_type == 'money_withdraw' %}<i class="fas fa-money-bill-wave mr-1"></i>
                                    {% elif action.action_type == 'chest_deposit' %}<i class="fas fa-box-archive mr-1"></i>
                                    {% elif action.action_type == 'chest_withdraw' %}<i class="fas fa-box-open mr-1"></i>
                                    {% elif action.action_type == 'warning_received' %}<i class="fas fa-triangle-exclamation mr-1"></i>
                                    {% elif action.action_type == 'ban_received' %}<i class="fas fa-gavel mr-1"></i>
                                    {% elif action.action_type == 'admin_jail' %}<i class="fas fa-lock mr-1"></i>
                                    {% elif action.action_type == 'admin_unjail' %}<i class="fas fa-lock-open mr-1"></i>
                                    {% elif action.action_type == 'admin_unban' %}<i class="fas fa-user-check mr-1"></i>
                                    {% elif action.action_type == 'mute_received' %}<i class="fas fa-volume-xmark mr-1"></i>
                                    {% elif action.action_type == 'trade' %}<i class="fas fa-handshake mr-1"></i>
                                    {% elif action.action_type == 'vehicle_contract' %}<i class="fas fa-file-signature mr-1"></i>
                                    {% elif action.action_type == 'vehicle_bought' %}<i class="fas fa-car mr-1"></i>
                                    {% elif action.action_type == 'vehicle_sold' %}<i class="fas fa-car-side mr-1"></i>
                                    {% elif action.action_type == 'vehicle_scrapped' %}<i class="fas fa-car-burst mr-1"></i>
                                    {% elif action.action_type == 'bank_heist_delivery' %}<i class="fas fa-sack-dollar mr-1"></i>
                                    {% elif action.action_type == 'faction_kicked' %}<i class="fas fa-user-slash mr-1"></i>
                                    {% elif action.action_type == 'kill_character' %}<i class="fas fa-skull mr-1"></i>
                                    {% else %}<i class="fas fa-circle-info mr-1"></i>{% endif %}
                                    {{ action.action_type | replace("_", " ") | title }}
                                </span>
                            </div>
                            <p class="text-gray-400 text-sm mt-1 truncate">{{ action.action_detail or 'No details' }}</p>
                        </div>
                        <span class="text-xs text-gray-500 ml-4 whitespace-nowrap">
                            {{ action.timestamp | time_ago }}
                        </span>
                    </div>
                </div>
                {% else %}
                <div class="px-6 py-8 text-center text-gray-500">
                    <i class="fas fa-inbox text-3xl mb-2"></i>
                    <p>No actions recorded</p>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Session History -->
        <div class="bg-p4k-card border border-p4k-border rounded-xl overflow-hidden">
            <div class="px-6 py-4 border-b border-p4k-border">
                <h2 class="text-lg font-semibold text-white">
                    <i class="fas fa-clock mr-2 text-p4k-green"></i>Session History
                </h2>
            </div>
            <div class="divide-y divide-p4k-border max-h-96 overflow-y-auto scrollbar-thin">
                {% for session in sessions %}
                <div class="px-6 py-3 hover:bg-p4k-border/30 transition-colors">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            {% if session.event_type == 'login' %}
                            <i class="fas fa-sign-in-alt text-p4k-green"></i>
                            <span class="text-p4k-green">Login</span>
                            {% else %}
                            <i class="fas fa-sign-out-alt text-p4k-red"></i>
                            <span class="text-p4k-red">Logout</span>
                            {% endif %}
                        </div>
                        <span class="text-gray-500 text-sm">{{ session.timestamp | time_ago }}</span>
                    </div>
                    {% if session.session_duration_seconds %}
                    <p class="text-gray-400 text-xs mt-1">
                        Duration: {{ (session.session_duration_seconds / 3600) | round(1) }}h
                    </p>
                    {% endif %}
                </div>
                {% else %}
                <div class="px-6 py-8 text-center text-gray-500">
                    <i class="fas fa-history text-3xl mb-2"></i>
                    <p>No sessions recorded</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- Rank History & Bans -->
    <div class="grid lg:grid-cols-2 gap-6">
        <!-- Rank History -->
        {% if rank_history %}
        <div class="bg-p4k-card border border-p4k-border rounded-xl overflow-hidden">
            <div class="px-6 py-4 border-b border-p4k-border">
                <h2 class="text-lg font-semibold text-white">
                    <i class="fas fa-award mr-2 text-p4k-purple"></i>Rank History
                </h2>
            </div>
            <div class="divide-y divide-p4k-border">
                {% for rank in rank_history %}
                <div class="px-6 py-3 hover:bg-p4k-border/30 transition-colors">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white font-medium">{{ rank.rank_name }}</p>
                            <p class="text-gray-500 text-xs">{{ rank.faction }}</p>
                        </div>
                        <div class="text-right">
                            {% if rank.is_current %}
                            <span class="text-p4k-green text-sm">Current</span>
                            {% else %}
                            <span class="text-gray-500 text-sm">{{ rank.rank_obtained | time_ago }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Ban History -->
        {% if bans %}
        <div class="bg-p4k-card border border-p4k-border rounded-xl overflow-hidden">
            <div class="px-6 py-4 border-b border-p4k-border">
                <h2 class="text-lg font-semibold text-white">
                    <i class="fas fa-ban mr-2 text-p4k-red"></i>Ban History
                </h2>
            </div>
            <div class="divide-y divide-p4k-border">
                {% for ban in bans %}
                <div class="px-6 py-3 hover:bg-p4k-border/30 transition-colors">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-white font-medium">{{ ban.reason or 'No reason' }}</p>
                            <p class="text-gray-500 text-xs">By: {{ ban.admin }} | Duration: {{ ban.duration }}</p>
                        </div>
                        <div class="text-right">
                            {% if ban.is_active %}
                            <span class="text-p4k-red text-sm">Active</span>
                            {% else %}
                            <span class="text-gray-500 text-sm">Expired</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
