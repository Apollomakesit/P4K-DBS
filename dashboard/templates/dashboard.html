<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro4Kings Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'p4k': {
                            'dark': '#0f1419',
                            'card': '#1a1f2e',
                            'border': '#2d3748',
                            'accent': '#3b82f6',
                            'green': '#10b981',
                            'red': '#ef4444',
                            'orange': '#f59e0b',
                            'purple': '#8b5cf6'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background: linear-gradient(135deg, #0f1419 0%, #1a1f2e 100%); min-height: 100vh; }
        .stat-card { transition: transform 0.2s, box-shadow 0.2s; }
        .stat-card:hover { transform: translateY(-2px); box-shadow: 0 10px 40px -10px rgba(59, 130, 246, 0.3); }
        .action-row { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .online-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1f2e; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 4px; }
    </style>
</head>
<body class="text-gray-100" x-data="dashboard()">
    <!-- Header -->
    <header class="bg-p4k-card/80 backdrop-blur-md border-b border-p4k-border sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-crown text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                            Pro4Kings Dashboard
                        </h1>
                        <p class="text-xs text-gray-500">Real-time server monitoring</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 text-sm text-gray-400">
                        <span class="online-pulse w-2 h-2 bg-green-500 rounded-full"></span>
                        <span>Live</span>
                    </div>
                    <span class="text-xs text-gray-500" x-text="'Updated: ' + lastUpdate"></span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Navigation Tabs -->
        <div class="flex space-x-2 mb-6 overflow-x-auto pb-2">
            <button @click="currentTab = 'overview'" 
                    :class="currentTab === 'overview' ? 'bg-p4k-accent text-white' : 'bg-p4k-card text-gray-400 hover:bg-p4k-border'"
                    class="px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap">
                <i class="fas fa-chart-line mr-2"></i>Overview
            </button>
            <button @click="currentTab = 'online'" 
                    :class="currentTab === 'online' ? 'bg-p4k-accent text-white' : 'bg-p4k-card text-gray-400 hover:bg-p4k-border'"
                    class="px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap">
                <i class="fas fa-users mr-2"></i>Online <span class="ml-1 px-2 py-0.5 bg-green-500/20 text-green-400 rounded-full text-xs" x-text="stats.online_now"></span>
            </button>
            <button @click="currentTab = 'actions'" 
                    :class="currentTab === 'actions' ? 'bg-p4k-accent text-white' : 'bg-p4k-card text-gray-400 hover:bg-p4k-border'"
                    class="px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap">
                <i class="fas fa-list mr-2"></i>Actions
            </button>
            <button @click="currentTab = 'factions'" 
                    :class="currentTab === 'factions' ? 'bg-p4k-accent text-white' : 'bg-p4k-card text-gray-400 hover:bg-p4k-border'"
                    class="px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap">
                <i class="fas fa-users-gear mr-2"></i>Factions
            </button>
            <button @click="currentTab = 'bans'" 
                    :class="currentTab === 'bans' ? 'bg-p4k-accent text-white' : 'bg-p4k-card text-gray-400 hover:bg-p4k-border'"
                    class="px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap">
                <i class="fas fa-ban mr-2"></i>Bans
            </button>
            <button @click="currentTab = 'search'" 
                    :class="currentTab === 'search' ? 'bg-p4k-accent text-white' : 'bg-p4k-card text-gray-400 hover:bg-p4k-border'"
                    class="px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap">
                <i class="fas fa-search mr-2"></i>Search
            </button>
        </div>

        <!-- Overview Tab -->
        <div x-show="currentTab === 'overview'" x-transition>
            <!-- Stats Cards -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
                <div class="stat-card bg-p4k-card rounded-xl p-4 border border-p4k-border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-400 text-sm">Total Players</span>
                        <i class="fas fa-users text-blue-400"></i>
                    </div>
                    <p class="text-2xl font-bold" x-text="stats.total_players?.toLocaleString() || '0'"></p>
                </div>
                <div class="stat-card bg-p4k-card rounded-xl p-4 border border-p4k-border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-400 text-sm">Online Now</span>
                        <i class="fas fa-circle text-green-400 online-pulse"></i>
                    </div>
                    <p class="text-2xl font-bold text-green-400" x-text="stats.online_now?.toLocaleString() || '0'"></p>
                </div>
                <div class="stat-card bg-p4k-card rounded-xl p-4 border border-p4k-border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-400 text-sm">Total Actions</span>
                        <i class="fas fa-bolt text-yellow-400"></i>
                    </div>
                    <p class="text-2xl font-bold" x-text="stats.total_actions?.toLocaleString() || '0'"></p>
                </div>
                <div class="stat-card bg-p4k-card rounded-xl p-4 border border-p4k-border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-400 text-sm">Actions (24h)</span>
                        <i class="fas fa-chart-line text-purple-400"></i>
                    </div>
                    <p class="text-2xl font-bold text-purple-400" x-text="stats.actions_24h?.toLocaleString() || '0'"></p>
                </div>
                <div class="stat-card bg-p4k-card rounded-xl p-4 border border-p4k-border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-400 text-sm">Logins Today</span>
                        <i class="fas fa-sign-in-alt text-cyan-400"></i>
                    </div>
                    <p class="text-2xl font-bold" x-text="stats.logins_today?.toLocaleString() || '0'"></p>
                </div>
                <div class="stat-card bg-p4k-card rounded-xl p-4 border border-p4k-border">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-400 text-sm">Active Bans</span>
                        <i class="fas fa-gavel text-red-400"></i>
                    </div>
                    <p class="text-2xl font-bold text-red-400" x-text="stats.active_bans?.toLocaleString() || '0'"></p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Recent Actions -->
                <div class="lg:col-span-2 bg-p4k-card rounded-xl border border-p4k-border overflow-hidden">
                    <div class="p-4 border-b border-p4k-border flex items-center justify-between">
                        <h2 class="font-semibold"><i class="fas fa-stream mr-2 text-blue-400"></i>Recent Actions</h2>
                        <select x-model="actionFilter" @change="fetchActions()" 
                                class="bg-p4k-dark border border-p4k-border rounded-lg px-3 py-1 text-sm">
                            <option value="">All Types</option>
                            <template x-for="type in actionTypes" :key="type.action_type">
                                <option :value="type.action_type" x-text="formatActionType(type.action_type) + ' (' + type.count + ')'"></option>
                            </template>
                        </select>
                    </div>
                    <div class="divide-y divide-p4k-border max-h-96 overflow-y-auto">
                        <template x-for="action in recentActions" :key="action.id">
                            <div class="action-row p-3 hover:bg-p4k-border/30 transition-colors">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-center space-x-3">
                                        <span class="w-8 h-8 rounded-lg flex items-center justify-center text-sm"
                                              :class="getActionColor(action.action_type)">
                                            <i :class="getActionIcon(action.action_type)"></i>
                                        </span>
                                        <div>
                                            <p class="text-sm">
                                                <span class="font-medium text-blue-400 cursor-pointer hover:underline" 
                                                      @click="viewPlayer(action.player_id)"
                                                      x-text="action.player_name || ('ID: ' + action.player_id)"></span>
                                                <span class="text-gray-400" x-text="' - ' + formatActionType(action.action_type)"></span>
                                            </p>
                                            <p class="text-xs text-gray-500 truncate max-w-md" x-text="action.action_detail"></p>
                                        </div>
                                    </div>
                                    <span class="text-xs text-gray-500 whitespace-nowrap" x-text="formatTime(action.timestamp)"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Online Players Sidebar -->
                <div class="bg-p4k-card rounded-xl border border-p4k-border overflow-hidden">
                    <div class="p-4 border-b border-p4k-border">
                        <h2 class="font-semibold"><i class="fas fa-circle text-green-400 mr-2 online-pulse"></i>Online Players</h2>
                    </div>
                    <div class="divide-y divide-p4k-border max-h-96 overflow-y-auto">
                        <template x-for="player in onlinePlayers.slice(0, 20)" :key="player.player_id">
                            <div class="p-3 hover:bg-p4k-border/30 transition-colors cursor-pointer" @click="viewPlayer(player.player_id)">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-sm" x-text="player.player_name"></p>
                                        <p class="text-xs text-gray-500" x-text="player.faction || 'No Faction'"></p>
                                    </div>
                                    <span class="text-xs text-gray-400" x-text="player.played_hours?.toFixed(1) + 'h'"></span>
                                </div>
                            </div>
                        </template>
                        <div x-show="onlinePlayers.length > 20" class="p-3 text-center text-gray-500 text-sm">
                            <span x-text="'+ ' + (onlinePlayers.length - 20) + ' more players'"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Online Tab -->
        <div x-show="currentTab === 'online'" x-transition>
            <div class="bg-p4k-card rounded-xl border border-p4k-border overflow-hidden">
                <div class="p-4 border-b border-p4k-border">
                    <h2 class="font-semibold"><i class="fas fa-users mr-2 text-green-400"></i>All Online Players (<span x-text="onlinePlayers.length"></span>)</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-p4k-dark">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Player</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">ID</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Faction</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Rank</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Hours</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-p4k-border">
                            <template x-for="player in onlinePlayers" :key="player.player_id">
                                <tr class="hover:bg-p4k-border/30 cursor-pointer" @click="viewPlayer(player.player_id)">
                                    <td class="px-4 py-3">
                                        <div class="flex items-center space-x-2">
                                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                            <span class="font-medium" x-text="player.player_name"></span>
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 text-gray-400" x-text="player.player_id"></td>
                                    <td class="px-4 py-3">
                                        <span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs" 
                                              x-text="player.faction || 'No Faction'"></span>
                                    </td>
                                    <td class="px-4 py-3 text-gray-400" x-text="player.faction_rank || '-'"></td>
                                    <td class="px-4 py-3 text-gray-400" x-text="player.played_hours?.toFixed(1) + 'h'"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Actions Tab -->
        <div x-show="currentTab === 'actions'" x-transition>
            <div class="bg-p4k-card rounded-xl border border-p4k-border overflow-hidden">
                <div class="p-4 border-b border-p4k-border flex flex-wrap items-center gap-4">
                    <h2 class="font-semibold"><i class="fas fa-list mr-2 text-purple-400"></i>Actions Log</h2>
                    <select x-model="actionFilter" @change="fetchActions()" 
                            class="bg-p4k-dark border border-p4k-border rounded-lg px-3 py-2 text-sm">
                        <option value="">All Types</option>
                        <template x-for="type in actionTypes" :key="type.action_type">
                            <option :value="type.action_type" x-text="formatActionType(type.action_type)"></option>
                        </template>
                    </select>
                    <input type="text" x-model="actionPlayerFilter" @input="debounceActions()" 
                           placeholder="Filter by Player ID"
                           class="bg-p4k-dark border border-p4k-border rounded-lg px-3 py-2 text-sm w-40">
                </div>
                <div class="divide-y divide-p4k-border max-h-[600px] overflow-y-auto">
                    <template x-for="action in recentActions" :key="action.id">
                        <div class="action-row p-4 hover:bg-p4k-border/30 transition-colors">
                            <div class="flex items-start justify-between">
                                <div class="flex items-start space-x-3">
                                    <span class="w-10 h-10 rounded-lg flex items-center justify-center"
                                          :class="getActionColor(action.action_type)">
                                        <i :class="getActionIcon(action.action_type)"></i>
                                    </span>
                                    <div>
                                        <p class="font-medium">
                                            <span class="text-blue-400 cursor-pointer hover:underline" 
                                                  @click="viewPlayer(action.player_id)"
                                                  x-text="action.player_name || ('ID: ' + action.player_id)"></span>
                                            <span class="text-gray-400" x-text="' - ' + formatActionType(action.action_type)"></span>
                                        </p>
                                        <p class="text-sm text-gray-400 mt-1" x-text="action.action_detail"></p>
                                        <template x-if="action.target_player_id">
                                            <p class="text-xs text-gray-500 mt-1">
                                                Target: <span class="text-blue-400 cursor-pointer hover:underline" 
                                                              @click="viewPlayer(action.target_player_id)"
                                                              x-text="action.target_player_name || action.target_player_id"></span>
                                            </p>
                                        </template>
                                    </div>
                                </div>
                                <span class="text-sm text-gray-500" x-text="formatTime(action.timestamp)"></span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Factions Tab -->
        <div x-show="currentTab === 'factions'" x-transition>
            <div x-show="!selectedFaction">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <template x-for="faction in factions" :key="faction.name">
                        <div class="bg-p4k-card rounded-xl border border-p4k-border p-4 cursor-pointer hover:border-blue-500 transition-colors"
                             @click="selectFaction(faction.name)">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-semibold" x-text="faction.name"></h3>
                                <span class="text-green-400 text-sm" x-text="faction.online_count + ' online'"></span>
                            </div>
                            <div class="flex items-center justify-between text-sm text-gray-400">
                                <span x-text="faction.member_count + ' members'"></span>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            
            <!-- Faction Detail -->
            <div x-show="selectedFaction">
                <button @click="selectedFaction = null; factionMembers = []" 
                        class="mb-4 text-blue-400 hover:underline">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Factions
                </button>
                <div class="bg-p4k-card rounded-xl border border-p4k-border overflow-hidden">
                    <div class="p-4 border-b border-p4k-border">
                        <h2 class="font-semibold text-xl" x-text="selectedFaction"></h2>
                        <p class="text-gray-400 text-sm" x-text="factionMembers.length + ' members'"></p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-p4k-dark">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Status</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Player</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">ID</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Rank</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Hours</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-p4k-border">
                                <template x-for="member in factionMembers" :key="member.player_id">
                                    <tr class="hover:bg-p4k-border/30 cursor-pointer" @click="viewPlayer(member.player_id)">
                                        <td class="px-4 py-3">
                                            <span class="w-2 h-2 rounded-full inline-block" 
                                                  :class="member.is_currently_online ? 'bg-green-500' : 'bg-gray-500'"></span>
                                        </td>
                                        <td class="px-4 py-3 font-medium" x-text="member.username"></td>
                                        <td class="px-4 py-3 text-gray-400" x-text="member.player_id"></td>
                                        <td class="px-4 py-3 text-gray-400" x-text="member.faction_rank || 'Membru'"></td>
                                        <td class="px-4 py-3 text-gray-400" x-text="(member.played_hours || 0).toFixed(1) + 'h'"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bans Tab -->
        <div x-show="currentTab === 'bans'" x-transition>
            <div class="bg-p4k-card rounded-xl border border-p4k-border overflow-hidden">
                <div class="p-4 border-b border-p4k-border flex items-center justify-between">
                    <h2 class="font-semibold"><i class="fas fa-gavel mr-2 text-red-400"></i>Banned Players</h2>
                    <label class="flex items-center space-x-2 text-sm">
                        <input type="checkbox" x-model="showExpiredBans" @change="fetchBans()" class="rounded">
                        <span>Show Expired</span>
                    </label>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-p4k-dark">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Status</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Player</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Reason</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Admin</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Duration</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Date</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-p4k-border">
                            <template x-for="ban in bans" :key="ban.id">
                                <tr class="hover:bg-p4k-border/30">
                                    <td class="px-4 py-3">
                                        <span class="px-2 py-1 rounded text-xs"
                                              :class="ban.is_active ? 'bg-red-500/20 text-red-400' : 'bg-gray-500/20 text-gray-400'"
                                              x-text="ban.is_active ? 'Active' : 'Expired'"></span>
                                    </td>
                                    <td class="px-4 py-3">
                                        <span class="font-medium cursor-pointer hover:text-blue-400" 
                                              @click="viewPlayer(ban.player_id)"
                                              x-text="ban.player_name"></span>
                                        <p class="text-xs text-gray-500" x-text="'ID: ' + ban.player_id"></p>
                                    </td>
                                    <td class="px-4 py-3 text-sm max-w-xs truncate" x-text="ban.reason"></td>
                                    <td class="px-4 py-3 text-gray-400" x-text="ban.admin"></td>
                                    <td class="px-4 py-3 text-gray-400" x-text="ban.duration"></td>
                                    <td class="px-4 py-3 text-gray-400" x-text="ban.ban_date"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Search Tab -->
        <div x-show="currentTab === 'search'" x-transition>
            <div class="bg-p4k-card rounded-xl border border-p4k-border p-6">
                <div class="max-w-xl mx-auto">
                    <div class="relative">
                        <input type="text" x-model="searchQuery" @input="debounceSearch()"
                               placeholder="Search players by name..."
                               class="w-full bg-p4k-dark border border-p4k-border rounded-xl px-5 py-4 text-lg focus:border-blue-500 focus:outline-none">
                        <i class="fas fa-search absolute right-5 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
            </div>
            
            <div x-show="searchResults.length > 0" class="mt-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <template x-for="player in searchResults" :key="player.player_id">
                        <div class="bg-p4k-card rounded-xl border border-p4k-border p-4 cursor-pointer hover:border-blue-500 transition-colors"
                             @click="viewPlayer(player.player_id)">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold"
                                     x-text="(player.username || 'U')[0].toUpperCase()"></div>
                                <div>
                                    <p class="font-semibold" x-text="player.username"></p>
                                    <p class="text-sm text-gray-400" x-text="'ID: ' + player.player_id"></p>
                                </div>
                            </div>
                            <div class="mt-3 flex items-center justify-between text-sm">
                                <span class="text-gray-400" x-text="player.faction || 'No Faction'"></span>
                                <span :class="player.is_online ? 'text-green-400' : 'text-gray-500'"
                                      x-text="player.is_online ? 'Online' : 'Offline'"></span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Player Detail Modal -->
        <div x-show="playerModal" x-transition 
             class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4"
             @click.self="playerModal = false">
            <div class="bg-p4k-card rounded-2xl border border-p4k-border max-w-2xl w-full max-h-[90vh] overflow-hidden">
                <div class="p-6 border-b border-p4k-border flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center text-white text-2xl font-bold"
                             x-text="(playerData?.profile?.username || 'U')[0].toUpperCase()"></div>
                        <div>
                            <h2 class="text-xl font-bold" x-text="playerData?.profile?.username"></h2>
                            <p class="text-gray-400" x-text="'ID: ' + playerData?.profile?.player_id"></p>
                        </div>
                    </div>
                    <button @click="playerModal = false" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[60vh]">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-p4k-dark rounded-lg p-3 text-center">
                            <p class="text-gray-400 text-xs">Status</p>
                            <p class="font-semibold" :class="playerData?.profile?.is_currently_online ? 'text-green-400' : 'text-gray-400'"
                               x-text="playerData?.profile?.is_currently_online ? 'Online' : 'Offline'"></p>
                        </div>
                        <div class="bg-p4k-dark rounded-lg p-3 text-center">
                            <p class="text-gray-400 text-xs">Faction</p>
                            <p class="font-semibold truncate" x-text="playerData?.profile?.faction || 'None'"></p>
                        </div>
                        <div class="bg-p4k-dark rounded-lg p-3 text-center">
                            <p class="text-gray-400 text-xs">Hours</p>
                            <p class="font-semibold" x-text="(playerData?.profile?.played_hours || 0).toFixed(1) + 'h'"></p>
                        </div>
                        <div class="bg-p4k-dark rounded-lg p-3 text-center">
                            <p class="text-gray-400 text-xs">Warnings</p>
                            <p class="font-semibold" :class="playerData?.profile?.warnings > 0 ? 'text-yellow-400' : ''"
                               x-text="(playerData?.profile?.warnings || 0) + '/3'"></p>
                        </div>
                    </div>
                    
                    <h3 class="font-semibold mb-3">Recent Actions</h3>
                    <div class="space-y-2 max-h-48 overflow-y-auto">
                        <template x-for="action in playerData?.actions?.slice(0, 10)" :key="action.id">
                            <div class="bg-p4k-dark rounded-lg p-3 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-blue-400" x-text="formatActionType(action.action_type)"></span>
                                    <span class="text-gray-500 text-xs" x-text="formatTime(action.timestamp)"></span>
                                </div>
                                <p class="text-gray-400 truncate" x-text="action.action_detail"></p>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        function dashboard() {
            return {
                currentTab: 'overview',
                lastUpdate: new Date().toLocaleTimeString(),
                stats: {},
                onlinePlayers: [],
                recentActions: [],
                actionTypes: [],
                actionFilter: '',
                actionPlayerFilter: '',
                factions: [],
                selectedFaction: null,
                factionMembers: [],
                bans: [],
                showExpiredBans: false,
                searchQuery: '',
                searchResults: [],
                playerModal: false,
                playerData: null,
                debounceTimer: null,

                async init() {
                    await this.fetchAll();
                    setInterval(() => this.fetchAll(), 30000); // Refresh every 30s
                },

                async fetchAll() {
                    await Promise.all([
                        this.fetchStats(),
                        this.fetchOnline(),
                        this.fetchActions(),
                        this.fetchActionTypes(),
                        this.fetchFactions(),
                        this.fetchBans()
                    ]);
                    this.lastUpdate = new Date().toLocaleTimeString();
                },

                async fetchStats() {
                    try {
                        const res = await fetch('/api/stats');
                        this.stats = await res.json();
                    } catch (e) { console.error('Stats error:', e); }
                },

                async fetchOnline() {
                    try {
                        const res = await fetch('/api/online');
                        const data = await res.json();
                        this.onlinePlayers = data.players || [];
                    } catch (e) { console.error('Online error:', e); }
                },

                async fetchActions() {
                    try {
                        let url = '/api/actions?limit=100';
                        if (this.actionFilter) url += `&type=${this.actionFilter}`;
                        if (this.actionPlayerFilter) url += `&player_id=${this.actionPlayerFilter}`;
                        const res = await fetch(url);
                        const data = await res.json();
                        this.recentActions = data.actions || [];
                    } catch (e) { console.error('Actions error:', e); }
                },

                async fetchActionTypes() {
                    try {
                        const res = await fetch('/api/action-types');
                        const data = await res.json();
                        this.actionTypes = data.types || [];
                    } catch (e) { console.error('Action types error:', e); }
                },

                async fetchFactions() {
                    try {
                        const res = await fetch('/api/factions');
                        const data = await res.json();
                        this.factions = data.factions || [];
                    } catch (e) { console.error('Factions error:', e); }
                },

                async selectFaction(name) {
                    this.selectedFaction = name;
                    try {
                        const res = await fetch(`/api/faction/${encodeURIComponent(name)}`);
                        const data = await res.json();
                        this.factionMembers = data.members || [];
                    } catch (e) { console.error('Faction error:', e); }
                },

                async fetchBans() {
                    try {
                        const res = await fetch(`/api/bans?expired=${this.showExpiredBans}`);
                        const data = await res.json();
                        this.bans = data.bans || [];
                    } catch (e) { console.error('Bans error:', e); }
                },

                debounceSearch() {
                    clearTimeout(this.debounceTimer);
                    this.debounceTimer = setTimeout(() => this.search(), 300);
                },

                debounceActions() {
                    clearTimeout(this.debounceTimer);
                    this.debounceTimer = setTimeout(() => this.fetchActions(), 300);
                },

                async search() {
                    if (this.searchQuery.length < 2) {
                        this.searchResults = [];
                        return;
                    }
                    try {
                        const res = await fetch(`/api/search?q=${encodeURIComponent(this.searchQuery)}`);
                        const data = await res.json();
                        this.searchResults = data.players || [];
                    } catch (e) { console.error('Search error:', e); }
                },

                async viewPlayer(playerId) {
                    if (!playerId) return;
                    try {
                        const res = await fetch(`/api/player/${playerId}`);
                        this.playerData = await res.json();
                        this.playerModal = true;
                    } catch (e) { console.error('Player error:', e); }
                },

                formatActionType(type) {
                    if (!type) return 'Unknown';
                    return type.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
                },

                formatTime(timestamp) {
                    if (!timestamp) return '';
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diff = (now - date) / 1000;
                    
                    if (diff < 60) return 'Just now';
                    if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
                    if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
                    return date.toLocaleDateString();
                },

                getActionColor(type) {
                    const colors = {
                        'item_given': 'bg-blue-500/20 text-blue-400',
                        'item_received': 'bg-green-500/20 text-green-400',
                        'money_transfer': 'bg-yellow-500/20 text-yellow-400',
                        'money_deposit': 'bg-emerald-500/20 text-emerald-400',
                        'money_withdraw': 'bg-orange-500/20 text-orange-400',
                        'warning_received': 'bg-red-500/20 text-red-400',
                        'ban_received': 'bg-red-600/20 text-red-500',
                        'admin_jail': 'bg-purple-500/20 text-purple-400',
                        'vehicle_contract': 'bg-cyan-500/20 text-cyan-400',
                        'chest_deposit': 'bg-indigo-500/20 text-indigo-400',
                        'chest_withdraw': 'bg-pink-500/20 text-pink-400'
                    };
                    return colors[type] || 'bg-gray-500/20 text-gray-400';
                },

                getActionIcon(type) {
                    const icons = {
                        'item_given': 'fas fa-gift',
                        'item_received': 'fas fa-box',
                        'money_transfer': 'fas fa-money-bill-transfer',
                        'money_deposit': 'fas fa-piggy-bank',
                        'money_withdraw': 'fas fa-money-bill',
                        'warning_received': 'fas fa-exclamation-triangle',
                        'ban_received': 'fas fa-ban',
                        'admin_jail': 'fas fa-lock',
                        'vehicle_contract': 'fas fa-car',
                        'chest_deposit': 'fas fa-box-archive',
                        'chest_withdraw': 'fas fa-box-open'
                    };
                    return icons[type] || 'fas fa-circle';
                }
            }
        }
    </script>
</body>
</html>
