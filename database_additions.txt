# Add this method to the Database class in database.py

def cleanup_old_data(self, actions_days: int = 90, login_events_days: int = 30, 
                     profile_history_days: int = 180, dry_run: bool = True) -> Dict[str, int]:
    """
    Clean up old data based on retention policy
    
    Args:
        actions_days: Keep actions newer than this many days
        login_events_days: Keep login events newer than this many days
        profile_history_days: Keep profile history newer than this many days
        dry_run: If True, only count what would be deleted without actually deleting
    
    Returns:
        Dictionary with counts of deleted rows
    """
    stats = {
        'actions_deleted': 0,
        'login_events_deleted': 0,
        'profile_history_deleted': 0
    }
    
    with self.get_connection() as conn:
        cursor = conn.cursor()
        
        # Calculate cutoff dates
        actions_cutoff = datetime.now() - timedelta(days=actions_days)
        login_cutoff = datetime.now() - timedelta(days=login_events_days)
        profile_cutoff = datetime.now() - timedelta(days=profile_history_days)
        
        # Count/delete old actions
        cursor.execute('''
            SELECT COUNT(*) FROM actions
            WHERE timestamp < ?
        ''', (actions_cutoff,))
        stats['actions_deleted'] = cursor.fetchone()[0]
        
        if not dry_run and stats['actions_deleted'] > 0:
            cursor.execute('DELETE FROM actions WHERE timestamp < ?', (actions_cutoff,))
            logger.info(f"Deleted {stats['actions_deleted']} old actions")
        
        # Count/delete old login events
        cursor.execute('''
            SELECT COUNT(*) FROM login_events
            WHERE timestamp < ?
        ''', (login_cutoff,))
        stats['login_events_deleted'] = cursor.fetchone()[0]
        
        if not dry_run and stats['login_events_deleted'] > 0:
            cursor.execute('DELETE FROM login_events WHERE timestamp < ?', (login_cutoff,))
            logger.info(f"Deleted {stats['login_events_deleted']} old login events")
        
        # Count/delete old profile history
        cursor.execute('''
            SELECT COUNT(*) FROM profile_history
            WHERE changed_at < ?
        ''', (profile_cutoff,))
        stats['profile_history_deleted'] = cursor.fetchone()[0]
        
        if not dry_run and stats['profile_history_deleted'] > 0:
            cursor.execute('DELETE FROM profile_history WHERE changed_at < ?', (profile_cutoff,))
            logger.info(f"Deleted {stats['profile_history_deleted']} old profile history entries")
        
        if not dry_run:
            # Vacuum to reclaim space
            conn.execute('VACUUM')
            logger.info("Database vacuumed to reclaim space")
        
        conn.commit()
    
    return stats
